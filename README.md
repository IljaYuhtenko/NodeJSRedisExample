# NodeJSRedisExample

Простое приложение, демонстрирующее один из вариантов работы с БД redis в CentOS 7  на примере приложения для работы с заметками (создание, чтение, редактирование, удаление)

# Описание

> Redis - сетевое журналируемое хранилище данных типа «ключ — значение» с открытым исходным кодом. Нереляционная высокопроизводительная СУБД. 

# Установка

## 1. Установка Redis

1. Устанавливаем epel repo, хранилище пакетов, созданное группой специалистов операционной системы Fedora:

```bash
# yum -y install epel-release
```

2. Затем:

 ```bash
 # sudo yum -y update
 ```

 3. Непосредственно установка redis, установка автозагрузки и запуск

 ```bash
# sudo yum install redis -y
# sudo systemctl enable redis
# sudo systemctl start redis
 ```

 4. Протестируем, установлена ли БД:

 ```bash
 # redis-cli ping
 ```

 В ответе должно быть:

 ```bash
 PONG
 ```

 ## 2. Настройка redis

 1. Открываем файл /etc/redis.conf с помощью любого текстового редактора

 2. Чтобы redis принимала запросы с любого адреса **комментируем** строку
 
 ```bash
 bind 127.0.0.1
 ```
 Но в этом случае, для соблюдения правил безопасности, следует установить мастер-пароль:

 3. Мастер-пароль задается в строке:

 ```bash
 requirepass
 ```

 Например: 

 ```bash
 requirepass mySuperStrongRedisDatabasePass
 ```

 ## 3. Установка приложения

 1. Скачаем файлы приложения: 

 ```bash
 # git clone https://github.com/IljaYuhtenko/nodejsredisexample
 ```

 2. Установим зависимости:

 ```bash
 # npm i 
 ```

 3. Настроим подключение к БД

 Создать в директории ./config файл credentials.js в котором экспортировать переменные port, host и redisPass, например:

 ```bash
 module.exports = {
    port: 6379,
    host: 'localhost',
    redisPass: 'mySuperStrongRedisDatabasePassword'
}
 ```
## 4. Запуск приложения

В корневой директории запустить

```bash
# node app.js
```

# Заметки и сюрпризы

1. Можно не устанавливать пароль, если не комментировать строку bind, а задать там тот адрес, с которого будет осуществляться подключение к БД. По умолчанию - с той же машины.

2. Если задавать пароль, то надо задавать очень сильный пароль. Так как redis лежит в оперативной памяти и быстро обрабатывает запросы, то в секунду злоумышленник можеть перепробовать до 150к паролей. А еще лучше сменить порт и поставить сильный пароль

3. Оказывается forEach ломает асинхронность. Поэтому все циклы - x **of** y

4. Для того, чтобы запросы к redis возвращали promise используется модуль bluebird, который к каждому виду запросов к БД добавляет Async. Например, hget => hgetAsync, hset => hsetAsync и т.д.

5. В данном приложении в качестве типа хранения данных redis использовалась структура хэш. Она требует уникального ключа, поля и значения поля. Встроееного механизма получения уникального ключа мне найти не удалось, поэтому была объявлена глобальная переменная redisID, которая при каждом добавлении записи просто инкрементируется

6. При использовании хэшей я делил приходящий json на отдельные поля, которые хранились в хэшах с разными полями, но одинаковым ключом. В качестве альтернативы можно использовать тип данных строка, где значением строки будет неразделенный json, а уникальный ключ можно получать аналогичным способом